<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin Panel | South Width</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#0e0e0e;
  color:#fff;
  font-family:Arial;
  padding:40px
}
h1{margin-bottom:20px}
.section{
  border:1px solid #333;
  padding:20px;
  margin-bottom:30px
}
.item{
  padding:10px;
  border-bottom:1px solid #222;
  font-size:14px
}
.item:last-child{border:none}
.badge{
  background:#444;
  padding:4px 8px;
  font-size:12px;
  margin-left:8px
}
.logout{
  display:inline-block;
  margin-bottom:30px;
  color:#ff5f5f;
  cursor:pointer
}
</style>
</head>

<body>

<h1>Panel Admin – South Width</h1>
<div class="logout" id="logout">Cerrar sesión</div>

<div class="section">
  <h3>Usuarios registrados</h3>
  <div id="users"></div>
</div>

<div class="section">
  <h3>Carritos de usuarios</h3>
  <div id="carts"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore,collection,getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAVyVlXFJuVF3snNO3fvQy1ud1WGo15ri4",
  authDomain: "south-width.firebaseapp.com",
  projectId: "south-width",
  storageBucket: "south-width.firebasestorage.app",
  messagingSenderId: "144617776304",
  appId: "1:144617776304:web:6ed82ac4dcb2354a620775"
};

const ADMINS = [
  "admin@southwidth.cl",
  "TU_CORREO@gmail.com"
];

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async user=>{
  if(!user || !ADMINS.includes(user.email)){
    location.href="index.html";
    return;
  }

  loadUsers();
  loadCarts();
});

document.getElementById("logout").onclick=()=>{
  signOut(auth).then(()=>location.href="index.html");
};

async function loadUsers(){
  const usersDiv=document.getElementById("users");
  const snap=await getDocs(collection(db,"usuarios"));
  usersDiv.innerHTML="";

  snap.forEach(doc=>{
    const u=doc.data();
    usersDiv.innerHTML+=`
      <div class="item">
        ${u.nombre||""} ${u.apellido||""}
        <span class="badge">${u.email}</span>
      </div>
    `;
  });
}

async function loadCarts(){
  const cartsDiv=document.getElementById("carts");
  const snap=await getDocs(collection(db,"carts"));
  cartsDiv.innerHTML="";

  snap.forEach(doc=>{
    const items=doc.data().items||[];
    cartsDiv.innerHTML+=`
      <div class="item">
        <strong>User ID:</strong> ${doc.id}<br>
        Productos: ${items.length}
      </div>
    `;
  });
}
</script>

</body>
</html>
